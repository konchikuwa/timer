<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>タイマー</title>
  <link rel="stylesheet" href="Timer.css">
  <script src="file:///C:/Users/takah/jQuery/jquery-3.5.0.min.js"></script>
</head>
<body>
  <p id="headline">タイマー</p>

  <div id="display">
    <span id="hours">00:</span>
    <span id="minutes">00:</span>
    <span id="seconds">00</span>
  </div>
  <div class="button">
    <button id="start_button">スタート</button>
    <button id="reset_button">リセット</button>
  </div>
  <div class="input">
    <input type="number" name="input_hours" class="input_number" id="input_hours" value="0" min="0" max="99">
    <span>時間</span>
    <input type="number" name="input_minutes" class="input_number" id="input_minutes" value="0" max="59" min="0">
    <span>分</span>
    <input type="number" name="input_seconds" class="input_number" id="input_seconds" value="0" max="59" min="0">
    <span>秒</span>
    <div>
      <button type="submit" onclick="allUpdate()" class="input_button" id="input_button">決定</button>
    </div>
  </div>
  <button type="submit" id="switchmode_button" onclick="switchMode()">ストップウォッチへ</button>
  <audio src="Timer_alert.mp3" loop preload="auto" class="sound"></audio>
  <script>
    var TimeKeep={
  nowseconds: 0,
  nowminutes: 0,
  nowhours: 0,
  startseconds : 0,
  startminutes : 0,
  starthours : 0,
  getstartTime : ()=>{
    let DD = new Date();
    TimeKeep.startseconds = DD.getSeconds();
    TimeKeep.startminutes = DD.getMinutes();
    TimeKeep.starthours = DD.getHours();
  },
  getnowTime : ()=>{
    let DD = new Date();
    TimeKeep.nowseconds = DD.getSeconds();
    TimeKeep.nowminutes = DD.getMinutes();
    TimeKeep.nowhours = DD.getHours();

    if(leave.seconds-TimeKeep.nowseconds+TimeKeep.startseconds>59){
      TimeDisplay.seconds = getDoubleNumber(leave.seconds-TimeKeep.nowseconds+TimeKeep.startseconds-60);
      TimeKeep.nowminutes--;
    }else if(leave.seconds-TimeKeep.nowseconds+TimeKeep.startseconds<0){
      TimeDisplay.seconds = getDoubleNumber(leave.seconds-TimeKeep.nowseconds+TimeKeep.startseconds+60);
      TimeKeep.nowminutes++;
    }else{
      TimeDisplay.seconds = getDoubleNumber(leave.seconds-TimeKeep.nowseconds+TimeKeep.startseconds);
    }

    if(leave.minutes-TimeKeep.nowminutes+TimeKeep.startminutes>59){
      TimeDisplay.minutes = getDoubleNumber(leaveminutess-TimeKeep.nowminutes+TimeKeep.startminutes-60);
      TimeKeep.nowhours--;
    }else if(leave.minutes-TimeKeep.nowminutes+TimeKeep.startminutes<0){
      TimeDisplay.minutes = getDoubleNumber(leave.minutes-TimeKeep.nowminutes+TimeKeep.startminutes+60);
      TimeKeep.nowhours++;
    }else{
      TimeDisplay.minutes = getDoubleNumber(leave.minutes-TimeKeep.nowminutes+TimeKeep.startminutes);
    }

    TimeDisplay.hours = getDoubleNumber(leave.hours-TimeKeep.nowhours+TimeKeep.starthours);
    hours.innerHTML=TimeDisplay.hours + ":";
    minutes.innerHTML=TimeDisplay.minutes + ":";
    seconds.innerHTML=TimeDisplay.seconds;

    if(TimeDisplay.hours ==="00" && TimeDisplay.minutes ==="00" && TimeDisplay.seconds ==="00"){

      TimerStop();
      $('body').attr("class", "over");
      $('#display').attr("class", "over");
      $('.sound').get(0).currentTime = 0;
      $('.sound').get(0).play();
    }
  }

};

var continuegetnowTime = 0;

var getDoubleNumber = i =>{
  i=("00" + i).slice(-2);
  return i;
}

var TimerStart = () =>{
  $('#start_button').html("ストップ");
  console.log("a");
  TimeKeep.getstartTime();
  $('#input_hours').prop("disabled", true);
  $('#input_minutes').prop("disabled", true);
  $('#input_seconds').prop("disabled", true);
  $('#input_button').prop("disabled", true);
  continuegetnowTime = setInterval("TimeKeep.getnowTime()",1);
}
var TimerStop = () =>{
  $('#start_button').html("スタート");
  clearInterval(continuegetnowTime);
  leave.seconds = Number(TimeDisplay.seconds);
  leave.minutes = Number(TimeDisplay.minutes);
  leave.hours = Number(TimeDisplay.hours);
}

var TimeDisplay = {
  hours: "00",
  minutes: "00",
  seconds: "00"
}

var Setting = {
  hours: 0,
  minutes: 0,
  seconds: 0
}

var leave = {
  hours: 0,
  minutes: 0,
  seconds: 0
}

$('#input_hours').click(()=>{
  if(document.getElementById("input_hours").value>=0 && document.getElementById("input_hours").value<100){
    Setting.hours = document.getElementById("input_hours").value;
    TimeDisplay.hours = getDoubleNumber(Setting.hours);
    hours.innerHTML=TimeDisplay.hours + ":";
    leave.hours = Setting.hours;
    $("#start_button").prop("disabled", false);
    $("#reset_button").prop("disabled", false);
    if(TimeDisplay.hours ==="00" && TimeDisplay.minutes ==="00" && TimeDisplay.seconds ==="00"){
      $("#start_button").prop("disabled", true);
      $("#reset_button").prop("disabled", true);
    }
  }else{
    alert("範囲を守ることが大切とは限らない！！");
  }
});
$('#input_minutes').click(()=>{
  if(document.getElementById("input_minutes").value>=0 && document.getElementById("input_minutes").value<60){
    Setting.minutes = document.getElementById("input_minutes").value;
    TimeDisplay.minutes = getDoubleNumber(Setting.minutes);
    minutes.innerHTML=TimeDisplay.minutes + ":";
    leave.minutes = Setting.minutes;
    $("#start_button").prop("disabled", false);
    $("#reset_button").prop("disabled", false);
    if(TimeDisplay.hours ==="00" && TimeDisplay.minutes ==="00" && TimeDisplay.seconds ==="00"){
      $("#start_button").prop("disabled", true);
      $("#reset_button").prop("disabled", true);
    }
  }else{
    alert("範囲を守ることが大切とは限らない！！");
  }
});
$('#input_seconds').click(()=>{
  if(document.getElementById("input_seconds").value>=0 && document.getElementById("input_seconds").value<60){
    Setting.seconds = document.getElementById("input_seconds").value
    TimeDisplay.seconds = getDoubleNumber(Setting.seconds);
    seconds.innerHTML=TimeDisplay.seconds;
    leave.seconds = Setting.seconds;
    $("#start_button").prop("disabled", false);
    $("#reset_button").prop("disabled", false);
    if(TimeDisplay.hours ==="00" && TimeDisplay.minutes ==="00" && TimeDisplay.seconds ==="00"){
      $("#start_button").prop("disabled", true);
      $("#reset_button").prop("disabled", true);
    }
  }else{
    alert("範囲を守ることが大切とは限らない！！");
  }
});

var allUpdate = () =>{
  $('#input_hours').trigger("click");
  if(document.getElementById("input_hours").value>=0 && document.getElementById("input_hours").value<100)
    $('#input_minutes').trigger("click");
  if(document.getElementById("input_minutes").value>=0 && document.getElementById("input_minutes").value<60)
    $('#input_seconds').trigger("click");
}

document.getElementById("start_button").onclick = function(){
  if($('#input_hours').prop("disabled") === true){
    TimerStop();
    $('#input_hours').prop("disabled", false);
    $('#input_minutes').prop("disabled", false);
    $('#input_seconds').prop("disabled", false);
    $('#input_button').prop("disabled", false);
    if(TimeDisplay.hours ==="00" && TimeDisplay.minutes ==="00" && TimeDisplay.seconds ==="00"){
      allUpdate();
      $('body').removeAttr("class","over");
      $('#display').removeAttr("class", "over");
      $('.sound').get(0).pause();
    }
  }else{
    TimerStart();
  }
}
document.getElementById("reset_button").onclick = function(){
  TimerStop();
  $('.input_number').val("0");
  allUpdate();
  $('#input_hours').prop("disabled", false);
  $('#input_minutes').prop("disabled", false);
  $('#input_seconds').prop("disabled", false);
  $('#input_button').prop("disabled", false);
  $('body').removeAttr("class","over");
  $('#display').removeAttr("class", "over");
  $('.sound').get(0).pause();
}
$("#start_button").prop("disabled", true);
$("#reset_button").prop("disabled", true);
$('.input_number').val("0");

var switchMode = () => {
  if(document.getElementById("switchmode_button").innerHTML === "ストップウォッチへ"){
    document.getElementById("switchmode_button").innerHTML = "タイマーへ";
    $('.input').hide();
    $('#headline').html("ストップウォッチ");
    
  }else{
    document.getElementById("switchmode_button").innerHTML = "ストップウォッチへ"
    $('.input').show();
    $('#headline').html("タイマー");
  }
}
  </script>
</body>
</html>
